function createCanvas(t,e){var n=new FileReader;n.onload=function(t){var n=new Image;n.src=t.target.result;var a=document.createElement("canvas");a.setAttribute("id","loaded-img"),a.width=n.width,a.height=n.height;var r=a.getContext("2d");r.drawImage(n,0,0),e(a)},n.readAsDataURL(document.getElementById("userImage").files[0])}function getDimensions(t){var e={},n=document.getElementById(t);return e.width=n.width,e.height=n.height,e}function getCanvasImgData(t){var e=document.getElementById(t),n=e.getContext("2d"),a=n.getImageData(0,0,e.width,e.height),r=a.data;return r}function arrayToString(t){for(var e="",n=0;n<t.length;n+=4)e+=String.fromCharCode(t[n])+String.fromCharCode(t[n+1])+String.fromCharCode(t[n+2]);return e}function stringToArray(t){for(var e=[],n=0;n<t.length;n++)n%3===0&&0!=n&&e.push(255),e.push(t.charCodeAt(n));return e}function generateUID(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function encryptLoadedImage(t,e){var n=getCanvasImgData(t),a=arrayToString(n),r=CryptoJS.AES.encrypt(a,e);return r}var ImageObject=function(t,e,n){this.encryptedData=t,this.width=e,this.height=n};$(document).on("ready",function(){$("label").click(function(){$("input:file").click()}).show(),$("input:file").change(function(){var t=$(this).val();createCanvas(t,function(t){$(".img-container").append(t)}),$(".encrypt-btn").toggle(),$("body").animate({scrollTop:$("div.img-container").offset().top},500)}),$(".encrypt-btn").on("click",function(){$("#pw-form").toggle(),$("#show-form").toggle(),$("body").animate({scrollTop:$("#pw-form").offset().top},500)}),$("#pw-form").on("submit",function(t){t.preventDefault(),$("#show-form").slideToggle();var e=$(".encrypt-pw").val(),n=encryptLoadedImage("loaded-img",e),a=getDimensions("loaded-img"),r=generateUID(),i=new ImageObject(n.toString(),a.width,a.height),o=JSON.stringify(i);$(".img-container").fadeOut(1e3,function(){$(this).remove()}),localStorage.setItem(r,o);var g=document.getElementById("loaded-img").toDataURL(),c=$("#qbert-canvas");c.css("width",a.width),c.css("height",a.height);var d=document.getElementById("qbert-canvas");d.width=a.width,d.height=a.height,new Raster(g).on("load",function(){raster=this,this.remove(),init(d.width,d.height),raster.onFrame=onFrame,raster.onResize=onResize,$(".display-url").css("text-align","center");var t=$('<a target="_blank" href="localhost:8012/#'+r+'">localhost:8012/#'+r+"<a>");$(".display-url").append(t)})})});